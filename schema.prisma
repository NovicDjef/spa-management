// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ServiceType {
  MASSOTHERAPIE
  ESTHETIQUE
}

enum UserRole {
  CLIENT
  MASSOTHERAPEUTE
  ESTHETICIENNE
}

enum Gender {
  HOMME
  FEMME
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  telephone String   @unique
  password  String?  // Pour les professionnels
  role      UserRole
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relation avec le profil client
  clientProfile ClientProfile?

  // Notes ajoutées par ce professionnel
  notes Note[]

  @@index([email])
  @@index([telephone])
}

model ClientProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Informations personnelles
  nom              String
  prenom           String
  adresse          String
  ville            String
  codePostal       String
  telMaison        String?
  telBureau        String?
  telCellulaire    String
  courriel         String
  dateNaissance    DateTime
  occupation       String?
  gender           Gender
  serviceType      ServiceType
  assuranceCouvert Boolean? // Pour massothérapie

  // Informations médicales (Massothérapie)
  raisonConsultation            String?
  diagnosticMedical             Boolean?
  diagnosticMedicalDetails      String?
  medicaments                   Boolean?
  medicamentsDetails            String?
  accidents                     Boolean?
  accidentsDetails              String?
  operationsChirurgicales       Boolean?
  operationsChirurgicalesDetails String?
  traitementsActuels            String?
  problemesCardiaques           Boolean?
  maladiesGraves                Boolean?
  maladiesGravesDetails         String?
  ortheses                      Boolean?
  orthesesDetails               String?
  allergies                     Boolean?
  allergiesDetails              String?

  // Conditions médicales (checkboxes)
  raideurs                   Boolean @default(false)
  arthrose                   Boolean @default(false)
  hernieDiscale              Boolean @default(false)
  oedeme                     Boolean @default(false)
  tendinite                  Boolean @default(false)
  mauxDeTete                 Boolean @default(false)
  flatulence                 Boolean @default(false)
  troublesCirculatoires      Boolean @default(false)
  hypothyroidie              Boolean @default(false)
  diabete                    Boolean @default(false)
  stresse                    Boolean @default(false)
  premenopause               Boolean @default(false)
  douleurMusculaire          Boolean @default(false)
  fibromyalgie               Boolean @default(false)
  rhumatisme                 Boolean @default(false)
  sciatique                  Boolean @default(false)
  bursite                    Boolean @default(false)
  migraine                   Boolean @default(false)
  diarrhee                   Boolean @default(false)
  phlebite                   Boolean @default(false)
  hypertension               Boolean @default(false)
  hypoglycemie               Boolean @default(false)
  burnOut                    Boolean @default(false)
  menopause                  Boolean @default(false)
  inflammationAigue          Boolean @default(false)
  arteriosclerose            Boolean @default(false)
  osteoporose                Boolean @default(false)
  mauxDeDos                  Boolean @default(false)
  fatigueDesJambes           Boolean @default(false)
  troublesDigestifs          Boolean @default(false)
  constipation               Boolean @default(false)
  hyperthyroidie             Boolean @default(false)
  hypotension                Boolean @default(false)
  insomnie                   Boolean @default(false)
  depressionNerveuse         Boolean @default(false)
  autres                     String?

  // Zones de douleur (body map)
  zonesDouleur Json? // Stockage des coordonnées ou zones sélectionnées

  // Informations esthétique (La Biosthetique)
  etatPeau                      String? // Grasse, Normale, Sèche, Déshydratée
  etatPores                     String? // Dilatés, Normaux, Resserrés
  coucheCornee                  String? // Épaisse, Normale, Fine
  irrigationSanguine            String? // Faible, Normale, Congestion
  impuretes                     String? // Comédons, Boutons, Inflammations
  sensibiliteCutanee            String? // Normale, Sensible, Réactive
  fumeur                        Boolean?
  niveauStress                  String?
  expositionSoleil              Boolean?
  protectionSolaire             Boolean?
  suffisanceEau                 Boolean?
  travailExterieur              Boolean?
  bainChauds                    Boolean?
  routineSoins                  Json? // Nettoyant, Sérum, etc.
  changementsRecents            Json? // Apparition rougeurs, etc.
  preferencePeau                String? // Rougeurs, sensibilité, etc.

  // Diagnostic visuel
  diagnosticVisuelDate          DateTime?
  diagnosticVisuelNotes         Json? // États de la peau, pores, etc.

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  notes      Note[]
  traitements Traitement[]

  @@index([nom, prenom])
  @@index([serviceType])
}

model Note {
  id        String   @id @default(cuid())
  content   String   @db.Text
  clientId  String
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  client ClientProfile @relation(fields: [clientId], references: [id], onDelete: Cascade)
  author User          @relation(fields: [createdBy], references: [id])

  @@index([clientId])
  @@index([createdBy])
}

model Traitement {
  id           String   @id @default(cuid())
  date         DateTime @default(now())
  soin         String
  remarque     String?  @db.Text
  prescription String?  @db.Text
  clientId     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  client ClientProfile @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([clientId])
  @@index([date])
}
